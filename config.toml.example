# The Watchman Configuration File
# Copy this to config.toml and customize for your environment

[neo4j]
uri = "bolt://localhost:7687"
user = "neo4j"
password = "watchman123"

[api]
port = 8000
log_level = "INFO"
title = "The Watchman API"
version = "1.0.0"

[ollama]
url = "http://192.168.1.69:11434"
embedding_model = "nomic-embed-text"
chat_model = "llama3.2"

[openrouter]
# Fallback LLM provider
api_key = ""  # Leave empty to disable
model = "anthropic/claude-3.5-sonnet"

[screenshot]
# Base interval for time-based capture (seconds)
interval = 300  # 5 minutes
dir = "/var/lib/watchman/shots"

# Screenshot diffing - only capture when screen changes
enable_diffing = true
diff_threshold = 0.10  # Capture if >10% of pixels changed
diff_algorithm = "phash"  # Options: phash, dhash, pixel

# Smart capture triggers
enable_smart_capture = true
capture_on_app_switch = true  # Capture when active window changes
capture_on_idle_return = true  # Capture when user returns from idle
idle_threshold = 300  # seconds before considered idle

# Similarity detection for deduplication
enable_similarity_clustering = true
similarity_threshold = 0.95  # 95% similar = duplicate
cluster_window = 3600  # seconds - only compare within 1 hour window

[ocr]
dir = "/var/lib/watchman/ocr"
chunk_dir = "/var/lib/watchman/chunks"
queue_size = 100
worker_threads = 2

# Lazy OCR processing
enable_lazy_processing = false  # If true, only process on-demand
auto_process_recent = true  # Process last 1 hour automatically
recent_threshold = 3600  # seconds

[embedding]
batch_size = 10

[retention]
# How long to keep raw images (days)
image_retention_days = 14
# How long to keep OCR text (days)
ocr_retention_days = 90
# Auto-delete similar/duplicate screenshots
auto_delete_duplicates = false

[privacy]
# Regex patterns to redact from OCR text
redact_patterns = [
    ".*@.*\\.com",
    "sk-.*",
    "ghp_.*",
    "AWS.*",
    "\\d{3}-\\d{2}-\\d{4}",  # SSN
]

# Applications to exclude from capture
exclude_apps = [
    "keepassxc",
    "gnome-keyring",
    "1password",
]

# Window titles to exclude (regex)
exclude_window_patterns = [
    ".*password.*",
    ".*private.*",
]

[system]
# Project directories to scan
project_roots = [
    "/home/user/projects",
    "/home/user/code",
    "/home/user/dev",
]

# Configuration directories to monitor
config_roots = [
    "/etc",
    "~/.config",
    "~/.ssh",
]

[mcp]
registry_path = "/opt/mcp"
registry_file = "config/mcp_registry.yaml"

[redis]
# Optional - for distributed queue management
url = ""  # Leave empty to use filesystem queue

[review]
# Lazy review features
enable_lazy_review = true
# Summarization model for review sessions
summarization_model = "llama3.2"
# Generate timeline summaries
auto_generate_summaries = false
summary_interval = 3600  # Generate hourly summaries

[features]
# Feature flags for experimental/optional features
visual_timeline = true
system_graph = true
event_tracking = true
gui_collector = false  # AT-SPI GUI event capture
file_ingest = true
mcp_registry = true
agent_interface = true

[performance]
# Performance tuning
screenshot_compression_quality = 85  # 1-100, JPEG quality
screenshot_max_dimension = 1920  # Scale down larger screenshots
enable_incremental_hashing = true  # Hash only changed regions
hash_grid_size = 16  # Grid size for incremental hashing
